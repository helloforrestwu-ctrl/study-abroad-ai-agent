"""
Timeline Agent - æ—¶é—´çº¿è§„åˆ’å™¨
ä¸ºå­¦ç”Ÿåˆ¶å®šè¯¦ç»†çš„ç”³è¯·æ—¶é—´çº¿
"""

from datetime import datetime, timedelta


class TimelineAgent:
    """ç”³è¯·æ—¶é—´çº¿è§„åˆ’Agent"""

    def __init__(self):
        self.timeline_template = {
            "æ ‡å‡†åŒ–è€ƒè¯•å‡†å¤‡": {
                "æå‰æœˆæ•°": 12,
                "æŒç»­æ—¶é•¿": 6,
                "å…³é”®ä»»åŠ¡": [
                    "ç¡®å®šç›®æ ‡åˆ†æ•°",
                    "æŠ¥åé¦–æ¬¡è€ƒè¯•",
                    "å®Œæˆå¤‡è€ƒè¯¾ç¨‹",
                    "å‚åŠ æ¨¡è€ƒ",
                    "æ­£å¼è€ƒè¯•(å¯å¤šæ¬¡)"
                ],
                "é£é™©æç¤º": "å»ºè®®é¢„ç•™2-3æ¬¡è€ƒè¯•æœºä¼šï¼Œé¿å…ä¸€æ¬¡å®šç”Ÿæ­»"
            },
            "é€‰æ ¡è°ƒç ”": {
                "æå‰æœˆæ•°": 10,
                "æŒç»­æ—¶é•¿": 3,
                "å…³é”®ä»»åŠ¡": [
                    "ç ”ç©¶ç›®æ ‡é™¢æ ¡é¡¹ç›®ç‰¹ç‚¹",
                    "åˆ†æå½•å–æ•°æ®å’Œè¦æ±‚",
                    "è”ç³»åœ¨è¯»å­¦é•¿å­¦å§",
                    "å‚åŠ çº¿ä¸Šå®£è®²ä¼š"
                ],
                "é£é™©æç¤º": "åŠ¡å¿…æ ¸å¯¹å„æ ¡å…·ä½“è¦æ±‚ï¼Œé¿å…é—æ¼ææ–™"
            },
            "æ–‡ä¹¦å‡†å¤‡": {
                "æå‰æœˆæ•°": 6,
                "æŒç»­æ—¶é•¿": 4,
                "å…³é”®ä»»åŠ¡": [
                    "å¤´è„‘é£æš´ç¡®å®šä¸»é¢˜",
                    "å®Œæˆåˆç¨¿",
                    "å¤šè½®ä¿®æ”¹æ¶¦è‰²",
                    "æ‰¾æ¯è¯­è€…proofreading",
                    "æœ€ç»ˆå®šç¨¿"
                ],
                "é£é™©æç¤º": "æ–‡ä¹¦éœ€è¦å¤šè½®æ‰“ç£¨ï¼Œåˆ‡å‹¿æœ€åä¸€å‘¨æ‰å¼€å§‹"
            },
            "æ¨èä¿¡å‡†å¤‡": {
                "æå‰æœˆæ•°": 4,
                "æŒç»­æ—¶é•¿": 2,
                "å…³é”®ä»»åŠ¡": [
                    "ç¡®å®šæ¨èäºº(2-3ä½)",
                    "æä¾›èƒŒæ™¯ææ–™ç»™æ¨èäºº",
                    "è·Ÿè¿›æ¨èä¿¡è¿›åº¦",
                    "ä¸Šä¼ è‡³ç½‘ç”³ç³»ç»Ÿ"
                ],
                "é£é™©æç¤º": "æå‰æ²Ÿé€šæ¨èäººï¼Œé¢„ç•™å……è¶³æ—¶é—´ï¼Œé¿å…æˆªæ­¢å‰å‚¬ä¿ƒ"
            },
            "æˆç»©å•ä¸ææ–™": {
                "æå‰æœˆæ•°": 3,
                "æŒç»­æ—¶é•¿": 2,
                "å…³é”®ä»»åŠ¡": [
                    "ç”³è¯·ä¸­è‹±æ–‡æˆç»©å•",
                    "æˆç»©å•è®¤è¯(å¦‚éœ€WESè®¤è¯)",
                    "å‡†å¤‡åœ¨è¯»è¯æ˜/æ¯•ä¸šè¯",
                    "å‡†å¤‡èµ„é‡‘è¯æ˜"
                ],
                "é£é™©æç¤º": "è®¤è¯æµç¨‹å¯èƒ½éœ€è¦4-8å‘¨ï¼ŒåŠ¡å¿…æå‰åŠç†"
            },
            "ç½‘ç”³æäº¤": {
                "æå‰æœˆæ•°": 2,
                "æŒç»­æ—¶é•¿": 3,
                "å…³é”®ä»»åŠ¡": [
                    "æ³¨å†Œç½‘ç”³è´¦å·",
                    "å¡«å†™ä¸ªäººä¿¡æ¯",
                    "ä¸Šä¼ æ‰€æœ‰ææ–™",
                    "æ”¯ä»˜ç”³è¯·è´¹",
                    "æäº¤å‰æœ€åæ£€æŸ¥"
                ],
                "é£é™©æç¤º": "å»ºè®®åœ¨DDLå‰1-2å‘¨æäº¤ï¼Œé¿å…ç³»ç»Ÿå´©æºƒç­‰æ„å¤–"
            },
            "é¢è¯•å‡†å¤‡": {
                "æå‰æœˆæ•°": 1,
                "æŒç»­æ—¶é•¿": 2,
                "å…³é”®ä»»åŠ¡": [
                    "ç ”ç©¶å¸¸è§é¢è¯•é—®é¢˜",
                    "å‡†å¤‡è‡ªæˆ‘ä»‹ç»",
                    "å‚åŠ æ¨¡æ‹Ÿé¢è¯•",
                    "å‡†å¤‡å‘é¢è¯•å®˜æé—®"
                ],
                "é£é™©æç¤º": "éƒ¨åˆ†é¡¹ç›®ä¼šæœ‰é¢è¯•ï¼Œæ”¶åˆ°é‚€è¯·å2å‘¨å†…å‡†å¤‡"
            },
            "ç­¾è¯åŠç†": {
                "æå‰æœˆæ•°": -2,
                "æŒç»­æ—¶é•¿": 2,
                "å…³é”®ä»»åŠ¡": [
                    "è·å¾—å½•å–åé¢„çº¦ç­¾è¯",
                    "å‡†å¤‡I-20/CASç­‰æ–‡ä»¶",
                    "å¡«å†™DS-160/ç­¾è¯è¡¨",
                    "å‡†å¤‡é¢ç­¾ææ–™",
                    "å‚åŠ ç­¾è¯é¢è¯•"
                ],
                "é£é™©æç¤º": "æ—ºå­£(5-7æœˆ)ç­¾è¯é¢„çº¦ç´§å¼ ï¼Œå°½æ—©é¢„çº¦"
            }
        }

    def create_timeline(self, student_info):
        """
        åˆ›å»ºä¸ªæ€§åŒ–æ—¶é—´çº¿
        :param student_info: å­¦ç”Ÿä¿¡æ¯
        :return: æ ¼å¼åŒ–çš„æ—¶é—´çº¿è¡¨æ ¼
        """
        print("ğŸ“… TimelineAgent å¼€å§‹åˆ¶å®šæ—¶é—´çº¿...")

        # å‡è®¾ç”³è¯·æˆªæ­¢æ—¥æœŸä¸º12æœˆ(å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´)
        deadline_date = datetime(2024, 12, 1)

        output = []
        output.append("\n" + "="*80)
        output.append("ğŸ“… ç•™å­¦ç”³è¯·æ—¶é—´çº¿è§„åˆ’ | Application Timeline")
        output.append("="*80 + "\n")

        output.append(f"å‡è®¾ç”³è¯·æˆªæ­¢æ—¶é—´: **{deadline_date.strftime('%Yå¹´%mæœˆ')}**")
        output.append(f"ç›®æ ‡å­¦ä½: {student_info.get('degree', 'N/A')}\n")

        # è¡¨æ ¼å¤´
        output.append("| é˜¶æ®µ | æ—¶é—´èŒƒå›´ | å…³é”®ä»»åŠ¡ | é£é™©æç¤º |")
        output.append("|------|----------|----------|----------|")

        for phase, details in self.timeline_template.items():
            start_month = details["æå‰æœˆæ•°"]
            duration = details["æŒç»­æ—¶é•¿"]

            # è®¡ç®—æ—¶é—´èŒƒå›´
            start_date = deadline_date - timedelta(days=start_month * 30)
            end_date = start_date + timedelta(days=duration * 30)

            time_range = f"{start_date.strftime('%Y.%m')} - {end_date.strftime('%Y.%m')}"

            # å…³é”®ä»»åŠ¡(å–å‰3ä¸ª)
            tasks = "\\n".join([f"â€¢ {task}" for task in details["å…³é”®ä»»åŠ¡"][:3]])

            risk = details["é£é™©æç¤º"]

            output.append(f"| **{phase}** | {time_range} | {tasks} | âš ï¸ {risk} |")

        output.append("\n" + "="*80)
        output.append("ã€æ—¶é—´è§„åˆ’å»ºè®®ã€‘")
        output.append("="*80 + "\n")

        output.append("1. **è¯­è¨€è€ƒè¯•**: å»ºè®®æœ€æ™šåœ¨ç”³è¯·å½“å¹´9æœˆå®Œæˆç›®æ ‡åˆ†æ•°")
        output.append("2. **æ–‡ä¹¦å†™ä½œ**: æš‘å‡(7-8æœˆ)æ˜¯æ–‡ä¹¦åˆ›ä½œé»„é‡‘æœŸï¼Œæœ‰å……è¶³æ—¶é—´æ‰“ç£¨")
        output.append("3. **æ¨èä¿¡**: 9æœˆå¼€å­¦åå°½å¿«è”ç³»æ¨èäººï¼Œé¿å…ä¸´è¿‘æˆªæ­¢å‚¬ä¿ƒ")
        output.append("4. **ç½‘ç”³æäº¤**: å»ºè®®åœ¨å®˜æ–¹æˆªæ­¢æ—¥æœŸå‰1-2å‘¨å®Œæˆæäº¤")
        output.append("5. **Early Decision**: å¦‚ç”³è¯·ED/EAé¡¹ç›®ï¼Œæ³¨æ„11æœˆåˆçš„æå‰æ‰¹æˆªæ­¢")
        output.append("\nâ° **å¸¸è§é£é™©ç‚¹æé†’**:")
        output.append("  - WESæˆç»©è®¤è¯éœ€4-8å‘¨ï¼ŒåŠ¡å¿…æå‰åŠç†")
        output.append("  - 12æœˆæ˜¯ç”³è¯·é«˜å³°ï¼Œç³»ç»Ÿå¯èƒ½æ‹¥å µï¼Œé¿å…æœ€åä¸€å¤©æäº¤")
        output.append("  - éƒ¨åˆ†æ¨èäººå¯èƒ½å»¶è¿Ÿï¼Œé¢„ç•™å‚¬ä¿ƒæ—¶é—´")

        output.append("\n" + "="*80 + "\n")

        print("âœ… æ—¶é—´çº¿è§„åˆ’å®Œæˆ")

        return "\n".join(output)
